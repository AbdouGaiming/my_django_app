{% extends 'base.html' %}
{% block title %}{{ page_title }}{% endblock %}
{% block content %}
<div
  class="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 py-6"
  dir="{% if language == 'ar' or language == 'ar_dz' %}rtl{% else %}ltr{% endif %}"
>
  <div class="max-w-2xl mx-auto px-4">
    <!-- Progress Header -->
    <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
      <div class="flex items-center justify-between mb-2">
        <span class="text-sm font-medium text-gray-600">
          {% if language == 'ar' or language == 'ar_dz' %} Ø§Ù„Ø®Ø·ÙˆØ© {{
          current_step }} Ù…Ù† {{ total_steps }} {% elif language == 'fr' %} Ã‰tape
          {{ current_step }} sur {{ total_steps }} {% else %} Step {{
          current_step }} of {{ total_steps }} {% endif %}
        </span>
        <span class="text-sm text-green-600 font-medium">
          {{ progress_percent }}%
        </span>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-3">
        <div
          class="bg-gradient-to-r from-green-400 to-green-600 h-3 rounded-full transition-all duration-500"
          style="width: {{ progress_percent }}%"
        ></div>
      </div>
    </div>

    <!-- Main Card -->
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
      <!-- Step Header -->
      <div
        class="bg-gradient-to-r from-green-500 to-green-600 px-6 py-5 text-white"
      >
        <h1 class="text-xl font-bold">
          {% if step_type == 'subject' %}
            {% if language == 'ar' or language == 'ar_dz' %}Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªØªØ¹Ù„Ù…ØŸ
            {% else %}
              {% if language == 'fr' %}Que voulez-vous apprendre ?
              {% else %}What do you want to learn?{% endif %}
            {% endif %}
          {% else %}
            {% if step_type == 'questions' %}
              {% if language == 'ar' or language == 'ar_dz' %}Ø£Ø³Ø¦Ù„Ø© Ù„ÙÙ‡Ù…Ùƒ Ø£ÙØ¶Ù„
              {% else %}
                {% if language == 'fr' %}Questions pour mieux vous connaÃ®tre
                {% else %}Questions to understand you better{% endif %}
              {% endif %}
            {% else %}
              {% if step_type == 'market' %}
                {% if language == 'ar' or language == 'ar_dz' %}Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±
                {% else %}
                  {% if language == 'fr' %}MarchÃ© du travail en AlgÃ©rie
                  {% else %}Job Market in Algeria{% endif %}
                {% endif %}
              {% endif %}
            {% endif %}
          {% endif %}
        </h1>
        <p class="text-green-100 mt-1 text-sm">
          {% if language == 'ar' or language == 'ar_dz' %} Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ ØªØ³Ø§Ø¹Ø¯Ù†Ø§ ÙÙŠ
          ØªØ®ØµÙŠØµ Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù… Ù„Ùƒ {% elif language == 'fr' %} Vos rÃ©ponses nous
          aident Ã  personnaliser votre parcours {% else %} Your answers help us
          customize your learning plan {% endif %}
        </p>
      </div>

      <!-- Form Content -->
      <form method="POST" action="" class="p-6">
        {% csrf_token %}
        <input type="hidden" name="step" value="{{ current_step }}" />

        {% if step_type == 'subject' %}
        <!-- Subject Selection -->
        <div class="space-y-4">
          <h3 class="text-lg font-medium text-gray-700 mb-4">
            {% if language == 'ar' or language == 'ar_dz' %}Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„Ø°ÙŠ ÙŠÙ‡Ù…Ùƒ:
            {% else %}
              {% if language == 'fr' %}Choisissez le domaine qui vous intÃ©resse:
              {% else %}Choose the field that interests you:{% endif %}
            {% endif %}
          </h3>
          <div class="grid grid-cols-2 gap-4">
            {% for subject in subjects %}
            <label class="cursor-pointer">
              <input type="radio" name="subject" value="{{ subject.value }}"
              class="sr-only peer" {% if subject.value == selected_subject %}checked{% endif %}>
              <div class="border-2 border-gray-200 rounded-xl p-4 text-center hover:border-green-400 hover:bg-green-50 peer-checked:border-green-500 peer-checked:bg-green-50 transition-all duration-200">
                <div class="text-3xl mb-2">{{ subject.icon }}</div>
                <span class="font-medium text-gray-800 block">{{ subject.label }}</span>
                <span class="text-xs text-green-600">
                  {% if subject.jobs > 0 %} {{ subject.jobs }}
                    {% if language == 'ar' or language == 'ar_dz' %}ÙØ±ØµØ© Ø¹Ù…Ù„
                    {% elif language == 'fr' %}emplois
                    {% else %}jobs{% endif %}
                  {% endif %}
                </span>
              </div>
            </label>
            {% endfor %}
          </div>
        </div>
        <!-- Custom Subject -->
        <div class="mt-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            {% if language == 'ar' or language == 'ar_dz' %}Ø£Ùˆ Ø§ÙƒØªØ¨ Ù…ÙˆØ¶ÙˆØ¹Ø§Ù‹ Ø¢Ø®Ø±:
            {% else %}
              {% if language == 'fr' %}Ou entrez un autre sujet:
              {% else %}Or enter another topic:{% endif %}
            {% endif %}
          </label>
          <input
            type="text"
            name="custom_subject"
            value="{{ custom_subject_value }}"
            placeholder="{% if language == 'ar' or language == 'ar_dz' %}Ù…Ø«Ø§Ù„: React Native, DevOps...{% else %}{% if language == 'fr' %}Ex: React Native, DevOps...{% else %}e.g., React Native, DevOps...{% endif %}{% endif %}"
            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500"
          />
        </div>
        {% endif %}

        {% if step_type == 'questions' %}
        <!-- Clarifying Questions -->
        <div class="space-y-6">
          {% for question in questions %}
          <div
            class="border-b border-gray-100 pb-6 {% if not forloop.last %}mb-6{% endif %}"
          >
            <h3 class="text-lg font-medium text-gray-800 mb-4">
              {{ forloop.counter }}. {{ question.text }}
            </h3>

            {% if question.type == 'single_choice' or question.type == 'yes_no' %}
            <div class="space-y-2">
              {% for option in question.options %}
              <label
                class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-green-400 hover:bg-green-50 transition-all"
              >
                <input
                  type="radio"
                  name="q_{{ question.id }}"
                  value="{{ option.value }}"
                  class="w-4 h-4 text-green-600 focus:ring-green-500"
                />
                <span class="ml-3 text-gray-700">{{ option.label }}</span>
              </label>
              {% endfor %}
            </div>
            {% elif question.type == 'multiple_choice' %}
            <div class="space-y-2">
              {% for option in question.options %}
              <label
                class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-green-400 hover:bg-green-50 transition-all"
              >
                <input
                  type="checkbox"
                  name="q_{{ question.id }}"
                  value="{{ option.value }}"
                  class="w-4 h-4 text-green-600 focus:ring-green-500 rounded"
                />
                <span class="ml-3 text-gray-700">{{ option.label }}</span>
              </label>
              {% endfor %}
            </div>
            {% elif question.type == 'text' %}
            <textarea
              name="q_{{ question.id }}"
              rows="3"
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500"
              placeholder="{% if language == 'ar' or language == 'ar_dz' %}Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§...{% else %}{% if language == 'fr' %}Ã‰crivez votre rÃ©ponse ici...{% else %}Write your answer here...{% endif %}{% endif %}"
            ></textarea>
            {% elif question.type == 'scale' %}
            <div class="flex justify-between items-center gap-2">
              {% for i in '12345678910'|make_list %}
              <label class="flex-1">
                <input
                  type="radio"
                  name="q_{{ question.id }}"
                  value="{{ forloop.counter }}"
                  class="sr-only peer"
                />
                <div
                  class="w-full py-2 text-center border border-gray-200 rounded-lg cursor-pointer hover:border-green-400 peer-checked:bg-green-500 peer-checked:text-white peer-checked:border-green-500 transition-all text-sm"
                >
                  {{ forloop.counter }}
                </div>
              </label>
              {% endfor %}
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>

        {% elif step_type == 'market' %}
        <!-- Market Insights -->
        <div class="space-y-6">
          {% if market_insights %}
          <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-3">
              ğŸ“Š {{ market_insights.subject }}
            </h3>
            <div class="grid grid-cols-2 gap-4 text-sm">
              <div class="bg-white p-3 rounded-lg">
                <span class="text-gray-500 block">
                  {% if language == 'ar' or language == 'ar_dz' %}Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø·Ù„Ø¨
                  {% else %}{% if language == 'fr' %}Niveau de demande{% else %}Demand Level{% endif %}{% endif %}
                </span>
                <span class="font-bold text-green-600"
                  >{{ market_insights.demand_level }}</span
                >
              </div>
              <div class="bg-white p-3 rounded-lg">
                <span class="text-gray-500 block">
                  {% if language == 'ar' or language == 'ar_dz' %}Ø§Ù„Ø§ØªØ¬Ø§Ù‡
                  {% else %}{% if language == 'fr' %}Tendance{% else %}Trend{% endif %}{% endif %}
                </span>
                <span class="font-bold">{{ market_insights.growth_text }}</span>
              </div>
              <div class="bg-white p-3 rounded-lg">
                <span class="text-gray-500 block">
                  {% if language == 'ar' or language == 'ar_dz' %}ÙØ±Øµ Ø§Ù„Ø¹Ù…Ù„
                  {% else %}{% if language == 'fr' %}OpportunitÃ©s{% else %}Job Opportunities{% endif %}{% endif %}
                </span>
                <span class="font-bold text-blue-600"
                  >{{ market_insights.job_count }}</span
                >
              </div>
              <div class="bg-white p-3 rounded-lg">
                <span class="text-gray-500 block">
                  {% if language == 'ar' or language == 'ar_dz' %}Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø§ØªØ¨
                  {% else %}{% if language == 'fr' %}Salaire moyen{% else %}Average Salary{% endif %}{% endif %}
                </span>
                <span class="font-bold text-gray-700"
                  >{{ market_insights.average_salary }}</span
                >
              </div>
            </div>
            <p class="mt-4 text-gray-600 text-sm">
              {{ market_insights.message }}
            </p>
          </div>
          {% endif %}

          <!-- Companies Section -->
          {% if matching_companies %}
          <div>
            <h3 class="text-lg font-medium text-gray-800 mb-3">
              ğŸ¢ {% if language == 'ar' or language == 'ar_dz' %}Ø´Ø±ÙƒØ§Øª ØªÙˆØ¸Ù ÙÙŠ
              Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ø§Ù„ {% else %}{% if language == 'fr' %}Entreprises qui recrutent {% else %}Companies Hiring{% endif %}{% endif %}
            </h3>
            <div class="space-y-3">
              {% for company in matching_companies %}
              <div
                class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
              >
                <div>
                  <span class="font-medium text-gray-800"
                    >{{ company.name }}</span
                  >
                  <span class="text-xs text-gray-500 block"
                    >{{ company.industry }}</span
                  >
                </div>
                {% if company.is_hiring %}
                <span
                  class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full"
                >
                  {% if language == 'ar' or language == 'ar_dz' %}ÙŠÙˆØ¸Ù
                  {% else %}{% if language == 'fr' %}Recrute{% else %}Hiring{% endif %}{% endif %}
                </span>
                {% endif %}
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
        {% endif %}

        <!-- Navigation Buttons -->
        <div class="flex justify-between mt-8 pt-6 border-t border-gray-100">
          {% if current_step > 1 %}
          <a
            href="?step={{ current_step|add:'-1' }}"
            class="px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all flex items-center gap-2"
          >
            <svg
              class="w-5 h-5 {% if language == 'ar' or language == 'ar_dz' %}rotate-180{% endif %}"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"
              ></path>
            </svg>
            {% if language == 'ar' or language == 'ar_dz' %}Ø§Ù„Ø³Ø§Ø¨Ù‚
            {% else %}{% if language == 'fr' %}PrÃ©cÃ©dent{% else %}Previous{% endif %}{% endif %}
          </a>
          {% else %}
          <div></div>
          {% endif %}

          <button
            type="submit"
            class="px-8 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white font-bold rounded-xl hover:from-green-600 hover:to-green-700 transition-all flex items-center gap-2 shadow-lg"
          >
            {% if current_step == total_steps %}
              {% if language == 'ar' or language == 'ar_dz' %}Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù… ğŸš€
              {% else %}{% if language == 'fr' %}CrÃ©er mon parcours ğŸš€{% else %}Create My Roadmap ğŸš€{% endif %}{% endif %}
            {% else %}
              {% if language == 'ar' or language == 'ar_dz' %}Ø§Ù„ØªØ§Ù„ÙŠ
              {% else %}{% if language == 'fr' %}Suivant{% else %}Next{% endif %}{% endif %}
            {% endif %}
            <svg
              class="w-5 h-5 {% if language == 'ar' or language == 'ar_dz' %}rotate-180{% endif %}"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              ></path>
            </svg>
          </button>
        </div>
      </form>
    </div>

    <!-- Help Text -->
    <div class="text-center mt-6 text-sm text-gray-500">
      {% if language == 'ar' or language == 'ar_dz' %} ğŸ’¡ ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
      {% else %}{% if language == 'fr' %} ğŸ’¡ Vous pouvez modifier vos rÃ©ponses plus tard dans les paramÃ¨tres {% else %} ğŸ’¡ You can change your answers later in profile settings {% endif %}{% endif %}
    </div>
  </div>
</div>
{% endblock %}
